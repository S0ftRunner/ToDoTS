(()=>{"use strict";class EventEmitter{constructor(){this._events=new Map}on(t,e){var i;this._events.has(t)||this._events.set(t,new Set),null===(i=this._events.get(t))||void 0===i||i.add(e)}off(t,e){var i;this._events.has(t)&&(this._events.get(t).delete(e),0===(null===(i=this._events.get(t))||void 0===i?void 0:i.size)&&this._events.delete(t))}emit(t,e){this._events.forEach(((i,o)=>{(o instanceof RegExp&&o.test(t)||o===t)&&i.forEach((t=>t(e)))}))}onAll(t){this.on("*",t)}offAll(){this._events=new Map}trigger(t,e){return(i={})=>{this.emit(t,Object.assign(Object.assign({},i||{}),e||{}))}}}const t=document.querySelector(".content"),e=document.querySelector(".popup"),i=new class Page{constructor(t){this.container=t,this._formContainer=this.container.querySelector(".todo-form-container"),this._todoContainer=this.container.querySelector(".todos__list")}set todoContainer(t){this._todoContainer.replaceChildren(...t)}set formContainer(t){t?this._formContainer.replaceChildren(t):this._formContainer.innerHTML=""}}(t),o=new class ToDoModel extends EventEmitter{constructor(){super(),this._items=[]}set items(t){this._items=t,this.emit("changed")}get items(){return this._items}addItem(t){const e=Math.max(...this._items.map((t=>Number(t.id))))+1,i={id:String(e),name:t};return this._items.push(i),this.emit("changed"),i}removeItem(t){this._items=this._items.filter((e=>e.id!==t)),this.emit("changed")}getItem(t){return this._items.find((e=>e.id===t))}editItem(t,e){this._items.find((e=>e.id===t)).name=e,this.emit("changed")}};o.items=[{id:"1",name:"Сделать проектную работу"},{id:"2",name:"Полить цветы"},{id:"3",name:"Пройти туториал по Реакту"},{id:"4",name:"Сделать фронт для своего проекта"},{id:"5",name:"Погулять с собакой"},{id:"6",name:"Разобраться в замыканиях"},{id:"7",name:"Решить задачу на Codewars"}];const s=new class Popup{constructor(t){this.container=t,this.closeButton=t.querySelector(".popup__close"),this._content=t.querySelector(".popup__content"),this.closeButton.addEventListener("click",this.close.bind(this)),this.container.addEventListener("click",this.close.bind(this)),this._content.addEventListener("click",(t=>{t.stopPropagation()}))}set content(t){this._content.replaceChildren(t)}open(){this.container.classList.add("popup_is-opened")}close(){this.container.classList.remove("popup_is-opened"),this.content=null}}(e),n=new class ItemPresenter{constructor(t,e,i,o,s){this.model=t,this.formConstuctor=e,this.viewPageContainer=i,this.viewItemConstructor=o,this.modal=s,this.itemTemplate=document.querySelector("#todo-item-template"),this.formTemplate=document.querySelector("#todo-form-template")}init(){this.todoForm=new this.formConstuctor(this.formTemplate),this.todoForm.setHandler(this.handleFormSubmit.bind(this)),this.todoForm.buttonText="Добавить",this.todoForm.placeholder="Следующее дело",this.viewPageContainer.formContainer=this.todoForm.render(),this.todoEditForm=new this.formConstuctor(this.formTemplate),this.todoEditForm.buttonText="Изменить",this.todoEditForm.placeholder="Новое название",this.model.on("changed",(()=>{this.renderView()}))}handleFormSubmit(t){this.model.addItem(t),this.todoForm.clearValue()}handleSubmitEditForm(t,e){this.model.editItem(e,t),this.todoEditForm.clearValue(),this.modal.close()}handleCopyItem(t){const e=this.model.getItem(t.id);this.model.addItem(e.name)}handleDeleteItem(t){this.model.removeItem(t.id)}handleEditItem(t){const e=this.model.getItem(t.id);this.todoEditForm.setValue(e.name),this.modal.content=this.todoEditForm.render(),this.todoEditForm.setHandler((e=>this.handleSubmitEditForm(e,t.id))),this.modal.open()}renderView(){const t=this.model.items.map((t=>{const e=new this.viewItemConstructor(this.itemTemplate);e.on("copy",this.handleCopyItem.bind(this)),e.on("edit",this.handleEditItem.bind(this)),e.on("delete",this.handleDeleteItem.bind(this));return e.render(t)})).reverse();this.viewPageContainer.todoContainer=t}}(o,class Form{constructor(t){this.formElement=t.content.querySelector(".todos__form").cloneNode(!0),this.inputField=this.formElement.querySelector(".todo-form__input"),this.submitButton=this.formElement.querySelector(".todo-form__submit-btn"),this.formElement.addEventListener("submit",(t=>{t.preventDefault(),this.handleFormSubmit(this.inputField.value)}))}setHandler(t){this.handleFormSubmit=t}render(){return this.formElement}setValue(t){this.inputField.value=t}getValue(){return this.inputField.value}clearValue(){this.formElement.reset()}set buttonText(t){this.submitButton.textContent=t}set placeholder(t){this.inputField.placeholder=t}},i,class Item extends EventEmitter{constructor(t){super(),this.itemElement=t.content.querySelector(".todo-item").cloneNode(!0),this.title=this.itemElement.querySelector(".todo-item__text"),this.copyButton=this.itemElement.querySelector(".todo-item__copy"),this.deleteButton=this.itemElement.querySelector(".todo-item__del"),this.editButton=this.itemElement.querySelector(".todo-item__edit"),this.deleteButton.addEventListener("click",(()=>this.emit("delete"))),this.copyButton.addEventListener("click",(()=>this.emit("copy"))),this.editButton.addEventListener("click",(()=>this.emit("edit")))}get id(){return this._id||""}set id(t){this._id=t}get name(){return this.title.textContent||""}set name(t){this.title.textContent=t}render(t){return this.name=t.name,this.id=t.id,this.itemElement}},s);n.init(),n.renderView()})();
//# sourceMappingURL=main.js.map